<!DOCTYPE html>
<html lang="en">
<%- include('../partials/head') %>
<body>
<div class="container py-4">
  <h3 class="mb-3"><i class="fa-solid fa-check-to-slot"></i> Redeem Voucher</h3>
  <form id="redeemForm" class="row g-3" onsubmit="redeem(event)">
    <div class="col-md-6">
      <label class="form-label">Voucher Code</label>
      <input type="text" class="form-control" id="code" required>
    </div>
    <div class="col-md-6">
      <label class="form-label">Salon ID (optional)</label>
      <input type="number" class="form-control" id="salon_id">
    </div>
    <div class="col-12">
      <label class="form-label">Notes</label>
      <textarea class="form-control" id="notes" rows="2"></textarea>
    </div>
    <div class="col-12">
      <button class="btn btn-success"><i class="fa-solid fa-check"></i> Redeem</button>
    </div>
  </form>
  <div id="msg" class="mt-3"></div>
</div>
<script>
async function redeem(e){
  e.preventDefault();
  const code = document.getElementById('code').value.trim();
  const salon_id = document.getElementById('salon_id').value || null;
  const notes = document.getElementById('notes').value || null;
  const r = await fetch(`/api/v1/vouchers/${encodeURIComponent(code)}/redeem`, {
    method: 'POST', headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ salon_id, notes })
  });
  const el = document.getElementById('msg');
  if(r.ok){ el.innerHTML = '<div class="alert alert-success">Redeemed!</div>'; }
  else {
    const j = await r.json();
    el.innerHTML = `<div class="alert alert-danger">${j.error||'Error'}</div>`;
  }
}
</script>
<%- include('../partials/foot') %>
